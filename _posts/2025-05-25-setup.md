---
layout: post
title: "C code on Maix Dock M1w "
date: 2025-05-24
categories: [blog]
---
# What is the Maix Dock M1W?
![Maix Dock M1W]({{ site.baseurl }}/assets/Maix-dock.jpg){: style="width:60%;" }

The Maix Dock M1W is a small RISC-V based Micro-controller, with the main point of interest being the integrated NPU called KPU. 
The board is based around the Kendryte K210 chip, which comes with 2 64bit RICS-V cores clocked at 400MHz and a dedicated NPU. 
The NPU is marketed with the ability to perform 1TOPS at INT8 precision.  
This makes the M1W an interresting product for low-power object detection.  

The specifictions for the M1W is as follows:  
*With ESP32-WROOM for comparision*

<table>
    <tr>
        <th>Item</th>
        <th>M1W / K210</th>
        <th>ESP32</th>
    </tr>
    <tr>
    <td>CPU:</td>
        <td>
            <p>Dual-core 64bit risc-v / 400MHz</p>
            <p> (double-precision FPU integration)</p>
        </td>
        <td>Dual-core 32bit Xtensa LX6 / 240MHz</td>
    </tr>
    <tr>
        <td>Memory:</td>
        <td> 8Mib 64bit on-chip SRAM </td>
        <td> 520Kib 32bit on-chip SRAM</td>
    </tr>
    <tr>
        <td>NPU / KPU:</td>
        <td> 1TOPS of INT8 multiplication</td>
        <td> No NPU</td>
    </tr>
    <tr>
        <td>Storage:</td>
        <td>16MiB Flash, support micro SDXC expansion storage (max 128GB)</td>
        <td>16MiB Flash</td>
    </tr>
    <tr>
        <td> WIFI: </td>
        <td> MaixDock (M1W) uses M1W (integrated ESP8285 2.4GHz WIFI SOC)</td>
        <td> ESP32 comes with integrated 2.4GHz WIFI</td>
    </tr>
    <tr>
        <td> Screen (package): </td>
        <td> 2.4 inch TFT, screen resolution: 320*240</td>
        <td> Depends on kit</td>
    </tr>
    <tr>
        <td> Camera (package):</td>
        <td> 30W pixel GC0328 camera </td>
        <td> Depends on kit</td>
    </tr>
    <tr>
        <td> TF card slot:</td>
        <td> Multimedia resource expansion, support large-capacity storage</td>
        <td> Depends on kit</td>
    </tr>
</table>  

# M1W Unboxing
I ordered the M1W from Aliexpress and it arrived in a small cardboard box with a plastic enclosure containing: the M1W itself, the 2.4 inch screen, a small camera already attached, an antenna and a USB-C  to Micro-b adapter. 
![Platic enclosure]({{ site.baseurl }}/assets/M1W-unbloxed.png){: style="width:80%;" }
# M1W Initial Power On
An inital power on of the M1W originally showed a welcome MaixDuino welcome message on the display, but when trying to recreate it for a picture the display only shows white

![Platic enclosure]({{ site.baseurl }}/assets/M1W-White.png){: style="width:80%;" }
# Programming on the M1W
When trying to find guides for the M1W especially for programming low-level C code, most links from official sources are either on chinese or points to non existent pages. 
However, Platformio has the M1W-board listed as *sipeed-maix-one-dock*, and is compatible with the arduino framework.  
So for an easy test I wrote a simple script making the builtin led blink.  SUCCESS!!!  
The platformio.ini and main.cpp code can be seen below  

```ruby
#platformio.ini

    [env:sipeed-maixduino]
    platform = kendryte210
    board = sipeed-maix-one-dock
    framework = arduino
    upload_speed = 115200
    monitor_speed = 115200
```


```c++
#main.cpp

    #include <Arduino.h>

    void setup() {
        pinMode(LED_BUILTIN, OUTPUT);
        Serial.begin(115200);
        while (!Serial) {}
        Serial.println("Starting LED blink");
    }

    void loop() {
        digitalWrite(LED_BUILTIN, HIGH);
        delay(500);
        digitalWrite(LED_BUILTIN, LOW);
        delay(500);
        Serial.println("Blink!");
    }
```
